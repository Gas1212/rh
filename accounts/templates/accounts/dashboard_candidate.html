{% extends "accounts/account.html" %}

{% block title %}Dashboard Candidat{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 py-8 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        
        <!-- En-t√™te avec salutation -->
        <div class="mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">
                        Bonjour, {{ candidate.first_name }} üëã
                    </h1>
                    <p class="mt-1 text-sm text-gray-600">
                        {% now "l d F Y" %} ‚Ä¢ Voici un aper√ßu de votre activit√©
                    </p>
                </div>
                <div class="mt-4 sm:mt-0 flex gap-3">
                    <a href="{% url 'all_jobs' %}" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition shadow-lg">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        Rechercher
                    </a>
                    <a href="{% url 'candidate_profile' %}" class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-lg">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                        Mon profil
                    </a>
                </div>
            </div>
        </div>

        <!-- Cartes statistiques -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Candidatures -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-blue-500 transform hover:scale-105 transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center">
                        <svg class="h-6 w-6 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                            <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
                <p class="text-3xl font-bold text-gray-900">{{ stats.total_applications }}</p>
                <p class="text-sm text-gray-600 mt-1">Candidatures envoy√©es</p>
                {% if stats.pending > 0 %}
                <p class="text-xs text-blue-600 font-medium mt-1">{{ stats.pending }} en attente</p>
                {% endif %}
            </div>

            <!-- Pr√©s√©lections -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-500 transform hover:scale-105 transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center">
                        <svg class="h-6 w-6 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                    </div>
                </div>
                <p class="text-3xl font-bold text-gray-900">{{ stats.shortlisted }}</p>
                <p class="text-sm text-gray-600 mt-1">Pr√©s√©lections</p>
                {% if stats.viewed > 0 %}
                <p class="text-xs text-purple-600 font-medium mt-1">{{ stats.viewed }} vues</p>
                {% endif %}
            </div>

            <!-- Entretiens -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-500 transform hover:scale-105 transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center">
                        <svg class="h-6 w-6 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"/>
                            <path d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.599.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"/>
                        </svg>
                    </div>
                </div>
                <p class="text-3xl font-bold text-gray-900">{{ stats.interviews }}</p>
                <p class="text-sm text-gray-600 mt-1">Entretiens</p>
            </div>

            <!-- Score moyen -->
            <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-yellow-500 transform hover:scale-105 transition-all duration-200">
                <div class="flex items-center justify-between mb-4">
                    <div class="h-12 w-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                        <svg class="h-6 w-6 text-yellow-600" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                        </svg>
                    </div>
                </div>
                <p class="text-3xl font-bold text-gray-900">{{ stats.avg_match_score }}%</p>
                <p class="text-sm text-gray-600 mt-1">Score moyen</p>
            </div>
        </div>

        <div class="grid lg:grid-cols-3 gap-6">
            
            <!-- Colonne principale -->
            <div class="lg:col-span-2 space-y-6">
                
                <!-- Mes candidatures r√©centes -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="p-6 border-b border-gray-100">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                    <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h2 class="text-lg font-bold text-gray-900">Mes candidatures r√©centes</h2>
                                    <p class="text-xs text-gray-600">{{ stats.total_applications }} candidature{{ stats.total_applications|pluralize }} au total</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    {% if recent_applications %}
                    <div class="divide-y divide-gray-100">
                        {% for item in recent_applications %}
                        <div class="p-6 hover:bg-gray-50 transition">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <a href="{% url 'job_detail' item.job.id %}" class="block group">
                                        <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 transition mb-1">
                                            {{ item.job.title }}
                                        </h3>
                                        <p class="text-sm text-gray-600 mb-2">
                                            {{ item.job.company_name }} ‚Ä¢ {{ item.job.location }}
                                        </p>
                                    </a>
                                    
                                    <div class="flex items-center gap-3 text-xs mt-3">
                                        <!-- Statut -->
                                        <span class="px-2 py-1 rounded-full
                                            {% if item.application.status == 'SUBMITTED' %}bg-blue-100 text-blue-700
                                            {% elif item.application.status == 'VIEWED' %}bg-yellow-100 text-yellow-700
                                            {% elif item.application.status == 'SHORTLISTED' %}bg-purple-100 text-purple-700
                                            {% elif item.application.status == 'INTERVIEW' %}bg-indigo-100 text-indigo-700
                                            {% elif item.application.status == 'ACCEPTED' %}bg-green-100 text-green-700
                                            {% elif item.application.status == 'REJECTED' %}bg-red-100 text-red-700
                                            {% endif %}">
                                            {{ item.application.get_status_display }}
                                        </span>
                                        
                                        <!-- Score -->
                                        {% if item.application.ai_match_score %}
                                        <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full">
                                            üéØ {{ item.application.ai_match_score }}%
                                        </span>
                                        {% endif %}
                                        
                                        <!-- Date -->
                                        <span class="text-gray-500">
                                            {% if item.days_ago == 0 %}
                                                Aujourd'hui
                                            {% elif item.days_ago == 1 %}
                                                Hier
                                            {% else %}
                                                Il y a {{ item.days_ago }} jours
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="p-12 text-center">
                        <div class="inline-block p-6 bg-gray-50 rounded-full mb-4">
                            <svg class="w-16 h-16 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Aucune candidature</h3>
                        <p class="text-gray-600 mb-4">Vous n'avez pas encore postul√© √† des offres</p>
                        <a href="{% url 'all_jobs' %}" class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-lg">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                            </svg>
                            D√©couvrir les offres
                        </a>
                    </div>
                    {% endif %}
                </div>

                <!-- Offres recommand√©es -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden">
                    <div class="p-6 border-b border-gray-100">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="h-10 w-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                    <svg class="h-6 w-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h2 class="text-lg font-bold text-gray-900">Offres recommand√©es pour vous</h2>
                                    <p class="text-xs text-gray-600">Bas√©es sur votre profil</p>
                                </div>
                            </div>
                            <a href="{% url 'all_jobs' %}" class="text-sm text-blue-600 hover:text-blue-700 font-medium">Voir tout ‚Üí</a>
                        </div>
                    </div>

                    {% if recommended_jobs %}
                    <div class="divide-y divide-gray-100">
                        {% for item in recommended_jobs %}
                        <a href="{% url 'job_detail' item.job.id %}" class="block p-6 hover:bg-gray-50 transition group">
                            <div class="flex items-start justify-between">
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-900 group-hover:text-blue-600 transition mb-1">
                                        {{ item.job.title }}
                                    </h3>
                                    <p class="text-sm text-gray-600 mb-3">
                                        {{ item.job.company_name }} ‚Ä¢ {{ item.job.location }}
                                    </p>
                                    
                                    <div class="flex items-center gap-2 text-xs text-gray-500">
                                        {% if item.job.contract_type %}
                                        <span class="px-2 py-1 bg-gray-100 rounded">
                                            {{ item.job.get_contract_type_display }}
                                        </span>
                                        {% endif %}
                                        {% if item.job.get_salary_range %}
                                        <span class="px-2 py-1 bg-green-50 text-green-700 rounded">
                                            {{ item.job.get_salary_range }}
                                        </span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="ml-4 flex-shrink-0">
                                    <div class="text-center">
                                        <div class="text-2xl font-bold
                                            {% if item.match_score >= 80 %}text-green-600
                                            {% elif item.match_score >= 60 %}text-blue-600
                                            {% else %}text-yellow-600{% endif %}">
                                            {{ item.match_score }}%
                                        </div>
                                        <p class="text-xs text-gray-500">Match</p>
                                    </div>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                    
                    <div class="p-4 bg-gray-50 border-t border-gray-100">
                        <a href="{% url 'all_jobs' %}" class="block text-center text-sm text-blue-600 hover:text-blue-700 font-medium">
                            Voir toutes les offres recommand√©es ‚Üí
                        </a>
                    </div>
                    {% else %}
                    <div class="p-12 text-center">
                        <p class="text-gray-600">Compl√©tez votre profil pour recevoir des recommandations personnalis√©es</p>
                        <a href="{% url 'candidate_profile' %}" class="inline-block mt-4 text-blue-600 hover:text-blue-700 font-medium">
                            Compl√©ter mon profil ‚Üí
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Sidebar droite -->
            <div class="space-y-6">
                
                <!-- Progression du profil -->
                <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-xl shadow-lg p-6 text-white">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg">Compl√©tez votre profil</h3>
                        <span class="text-2xl font-bold">{{ stats.profile_completion }}%</span>
                    </div>
                    <div class="w-full bg-white bg-opacity-20 rounded-full h-3 mb-4">
                        <div class="bg-white h-3 rounded-full transition-all duration-500" style="width: {{ stats.profile_completion }}%"></div>
                    </div>
                    
                    {% if stats.profile_completion < 100 %}
                    <div class="space-y-2 mb-4">
                        <p class="text-sm opacity-90">
                            {% if not candidate.cv_url %}
                            ‚ö†Ô∏è Ajoutez votre CV
                            {% elif not candidate.skills or candidate.skills|length == 0 %}
                            ‚ö†Ô∏è Ajoutez vos comp√©tences
                            {% elif not candidate.bio %}
                            ‚ö†Ô∏è R√©digez votre bio
                            {% else %}
                            ‚úÖ Profil presque complet !
                            {% endif %}
                        </p>
                    </div>
                    {% endif %}
                    
                    <a href="{% url 'candidate_profile' %}" class="block w-full bg-white text-blue-600 text-center py-2 rounded-lg font-semibold hover:bg-opacity-90 transition">
                        {% if stats.profile_completion < 100 %}Compl√©ter{% else %}Voir{% endif %} mon profil
                    </a>
                </div>

                <!-- Conseils IA -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex items-center mb-4">
                        <div class="h-10 w-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-lg flex items-center justify-center mr-3">
                            <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                        </div>
                        <h3 class="font-bold text-gray-900">Insights IA ü§ñ</h3>
                    </div>
                    <div class="space-y-3">
                        {% if stats.profile_completion < 80 %}
                        <div class="bg-yellow-50 border-l-4 border-yellow-500 p-3 rounded">
                            <p class="text-sm text-gray-700">
                                <span class="font-semibold">Profil incomplet:</span> Compl√©tez votre profil pour augmenter vos chances de 60%
                            </p>
                        </div>
                        {% endif %}
                        
                        {% if stats.avg_match_score > 0 %}
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-3 rounded">
                            <p class="text-sm text-gray-700">
                                <span class="font-semibold">Score moyen:</span> Vos candidatures ont un score de {{ stats.avg_match_score }}%
                            </p>
                        </div>
                        {% endif %}
                        
                        {% if recommended_jobs|length > 0 %}
                        <div class="bg-green-50 border-l-4 border-green-500 p-3 rounded">
                            <p class="text-sm text-gray-700">
                                <span class="font-semibold">Opportunit√©s:</span> {{ recommended_jobs|length }} offre{{ recommended_jobs|length|pluralize }} correspondent √† votre profil
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Actions rapides -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="font-bold text-gray-900 mb-4">Actions rapides</h3>
                    <div class="space-y-2">
                        <a href="{% url 'all_jobs' %}" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition group">
                            <div class="h-10 w-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform">
                                <svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-gray-700 group-hover:text-blue-600 transition">Rechercher des offres</span>
                        </a>
                        <a href="{% url 'candidate_profile' %}" class="flex items-center p-3 rounded-lg hover:bg-gray-50 transition group">
                            <div class="h-10 w-10 bg-green-100 rounded-lg flex items-center justify-center mr-3 group-hover:scale-110 transition-transform">
                                <svg class="h-5 w-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                </svg>
                            </div>
                            <span class="text-sm font-medium text-gray-700 group-hover:text-green-600 transition">Modifier mon profil</span>
                        </a>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<style>
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .max-w-7xl > div {
        animation: fadeIn 0.6s ease-out;
    }
</style>
{% endblock %}